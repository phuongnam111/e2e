#!/bin/bash

# ==============================================================================
# OrangeHRM Automation - Complete Auto Setup Script for macOS/Linux
# This script creates the entire project structure with all files and content
# ==============================================================================

PROJECT="orangehrm-automation"

echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘   OrangeHRM UI Automation Framework - Auto Setup            â•‘"
echo "â•‘   Creating complete project structure...                     â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

# Create project directory
echo "ðŸ“ Creating project directory: $PROJECT"
mkdir -p $PROJECT
cd $PROJECT

# Create directory structure
echo "ðŸ“‚ Creating directory structure..."
mkdir -p src/main/java/{pages,utils,models}
mkdir -p src/test/{java/{runners,steps},resources/features}
mkdir -p target/cucumber-reports

echo "âœ… Directory structure created"
echo ""

# ==============================================================================
# CREATE POM.XML
# ==============================================================================
echo "ðŸ“ Creating pom.xml..."
cat > pom.xml << 'EOF'
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 
         http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <groupId>com.abbank</groupId>
    <artifactId>orangehrm-automation</artifactId>
    <version>1.0.0</version>
    <packaging>jar</packaging>

    <name>OrangeHRM UI Automation</name>

    <properties>
        <maven.compiler.source>11</maven.compiler.source>
        <maven.compiler.target>11</maven.compiler.target>
        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
        <selenium.version>4.16.1</selenium.version>
        <cucumber.version>7.14.1</cucumber.version>
        <testng.version>7.8.0</testng.version>
        <webdrivermanager.version>5.6.2</webdrivermanager.version>
    </properties>

    <dependencies>
        <!-- Selenium WebDriver -->
        <dependency>
            <groupId>org.seleniumhq.selenium</groupId>
            <artifactId>selenium-java</artifactId>
            <version>${selenium.version}</version>
        </dependency>

        <!-- WebDriverManager -->
        <dependency>
            <groupId>io.github.bonigarcia</groupId>
            <artifactId>webdrivermanager</artifactId>
            <version>${webdrivermanager.version}</version>
        </dependency>

        <!-- Cucumber -->
        <dependency>
            <groupId>io.cucumber</groupId>
            <artifactId>cucumber-java</artifactId>
            <version>${cucumber.version}</version>
        </dependency>

        <dependency>
            <groupId>io.cucumber</groupId>
            <artifactId>cucumber-testng</artifactId>
            <version>${cucumber.version}</version>
        </dependency>

        <!-- TestNG -->
        <dependency>
            <groupId>org.testng</groupId>
            <artifactId>testng</artifactId>
            <version>${testng.version}</version>
        </dependency>

        <!-- Logging -->
        <dependency>
            <groupId>org.slf4j</groupId>
            <artifactId>slf4j-simple</artifactId>
            <version>2.0.9</version>
        </dependency>
    </dependencies>

    <build>
        <plugins>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-surefire-plugin</artifactId>
                <version>3.2.2</version>
                <configuration>
                    <includes>
                        <include>**/TestRunner.java</include>
                    </includes>
                </configuration>
            </plugin>

            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-compiler-plugin</artifactId>
                <version>3.11.0</version>
                <configuration>
                    <source>11</source>
                    <target>11</target>
                </configuration>
            </plugin>
        </plugins>
    </build>
</project>
EOF

echo "âœ… pom.xml created"

# ==============================================================================
# CREATE CONFIG.PROPERTIES
# ==============================================================================
echo "ðŸ“ Creating config.properties..."
cat > src/test/resources/config.properties << 'EOF'
# Application Configuration
base.url=https://opensource-demo.orangehrmlive.com/web/index.php/auth/login
username=Admin
password=admin123

# Browser Configuration
browser=chrome
headless=false
implicit.wait=10
explicit.wait=20
page.load.timeout=30

# Test Data
test.user.role=Admin
test.user.status=Enabled
EOF

echo "âœ… config.properties created"

# ==============================================================================
# CREATE .GITIGNORE
# ==============================================================================
echo "ðŸ“ Creating .gitignore..."
cat > .gitignore << 'EOF'
# Maven
target/
pom.xml.tag
pom.xml.releaseBackup
pom.xml.versionsBackup
pom.xml.next
release.properties
dependency-reduced-pom.xml
buildNumber.properties
.mvn/timing.properties
.mvn/wrapper/maven-wrapper.jar

# IDE
.idea/
*.iml
*.ipr
*.iws
.vscode/
.settings/
.classpath
.project

# OS
.DS_Store
Thumbs.db

# Test Reports
test-output/
cucumber-reports/
screenshots/
*.log

# Compiled
*.class
*.jar
*.war
*.ear
EOF

echo "âœ… .gitignore created"

# ==============================================================================
# CREATE TESTNG.XML
# ==============================================================================
echo "ðŸ“ Creating testng.xml..."
cat > testng.xml << 'EOF'
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE suite SYSTEM "https://testng.org/testng-1.0.dtd">
<suite name="OrangeHRM Automation Suite" parallel="false" thread-count="1">
    
    <test name="User Management Tests">
        <classes>
            <class name="runners.TestRunner"/>
        </classes>
    </test>
    
</suite>
EOF

echo "âœ… testng.xml created"

# ==============================================================================
# CREATE FEATURE FILE
# ==============================================================================
echo "ðŸ“ Creating user_management.feature..."
cat > src/test/resources/features/user_management.feature << 'EOF'
Feature: User Management
  As an Admin user
  I want to manage users in the system
  So that I can control access to the application

  Background:
    Given I am on the OrangeHRM login page
    When I login with valid credentials
    Then I should be redirected to the dashboard

  Scenario: Create and verify a new user
    Given I navigate to Admin User Management page
    When I create a new user with the following details:
      | Employee Name      | Username             | User Role | Status  |
      | Peter Mac Anderson | testuser_<timestamp> | Admin     | Enabled |
    Then the user should be created successfully
    When I search for the user by username "testuser_<timestamp>"
    Then the user should appear in the Records Found table
    And the user details should be correct
EOF

echo "âœ… user_management.feature created"

# ==============================================================================
# CREATE BASEPAGE.JAVA
# ==============================================================================
echo "ðŸ“ Creating BasePage.java..."
cat > src/main/java/pages/BasePage.java << 'EOF'
package pages;

import org.openqa.selenium.By;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.support.PageFactory;
import org.openqa.selenium.support.ui.ExpectedConditions;
import org.openqa.selenium.support.ui.WebDriverWait;
import utils.ConfigReader;

import java.time.Duration;

/**
 * Base Page Object class that contains common methods for all pages
 */
public abstract class BasePage {
    
    protected WebDriver driver;
    protected WebDriverWait wait;
    
    public BasePage(WebDriver driver) {
        this.driver = driver;
        this.wait = new WebDriverWait(driver, 
            Duration.ofSeconds(ConfigReader.getExplicitWait()));
        PageFactory.initElements(driver, this);
    }
    
    /**
     * Wait for element to be visible
     */
    protected WebElement waitForElementVisible(By locator) {
        return wait.until(ExpectedConditions.visibilityOfElementLocated(locator));
    }
    
    /**
     * Wait for element to be clickable
     */
    protected WebElement waitForElementClickable(By locator) {
        return wait.until(ExpectedConditions.elementToBeClickable(locator));
    }
    
    /**
     * Click on element
     */
    protected void click(By locator) {
        waitForElementClickable(locator).click();
    }
    
    /**
     * Type text into element
     */
    protected void type(By locator, String text) {
        WebElement element = waitForElementVisible(locator);
        element.clear();
        element.sendKeys(text);
    }
    
    /**
     * Get text from element
     */
    protected String getText(By locator) {
        return waitForElementVisible(locator).getText();
    }
    
    /**
     * Check if element is displayed
     */
    protected boolean isDisplayed(By locator) {
        try {
            return waitForElementVisible(locator).isDisplayed();
        } catch (Exception e) {
            return false;
        }
    }
    
    /**
     * Wait for page to load completely
     */
    protected void waitForPageLoad() {
        wait.until(driver -> 
            ((org.openqa.selenium.JavascriptExecutor) driver)
                .executeScript("return document.readyState").equals("complete")
        );
    }
}
EOF

echo "âœ… BasePage.java created"

# ==============================================================================
# CREATE LOGINPAGE.JAVA
# ==============================================================================
echo "ðŸ“ Creating LoginPage.java..."
cat > src/main/java/pages/LoginPage.java << 'EOF'
package pages;

import org.openqa.selenium.By;
import org.openqa.selenium.WebDriver;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

/**
 * Page Object for OrangeHRM Login Page
 */
public class LoginPage extends BasePage {
    
    private static final Logger log = LoggerFactory.getLogger(LoginPage.class);
    
    // Locators
    private final By usernameField = By.name("username");
    private final By passwordField = By.name("password");
    private final By loginButton = By.xpath("//button[@type='submit']");
    private final By loginContainer = By.className("orangehrm-login-container");
    
    public LoginPage(WebDriver driver) {
        super(driver);
    }
    
    /**
     * Check if login page is displayed
     */
    public boolean isLoginPageDisplayed() {
        log.info("Verifying login page is displayed");
        return isDisplayed(loginContainer);
    }
    
    /**
     * Enter username
     */
    public LoginPage enterUsername(String username) {
        log.info("Entering username: {}", username);
        type(usernameField, username);
        return this;
    }
    
    /**
     * Enter password
     */
    public LoginPage enterPassword(String password) {
        log.info("Entering password");
        type(passwordField, password);
        return this;
    }
    
    /**
     * Click login button
     */
    public DashboardPage clickLogin() {
        log.info("Clicking login button");
        click(loginButton);
        return new DashboardPage(driver);
    }
    
    /**
     * Perform login with credentials
     */
    public DashboardPage login(String username, String password) {
        log.info("Performing login for user: {}", username);
        return enterUsername(username)
               .enterPassword(password)
               .clickLogin();
    }
}
EOF

echo "âœ… LoginPage.java created"

# ==============================================================================
# CREATE DASHBOARDPAGE.JAVA
# ==============================================================================
echo "ðŸ“ Creating DashboardPage.java..."
cat > src/main/java/pages/DashboardPage.java << 'EOF'
package pages;

import org.openqa.selenium.By;
import org.openqa.selenium.WebDriver;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

/**
 * Page Object for OrangeHRM Dashboard Page
 */
public class DashboardPage extends BasePage {
    
    private static final Logger log = LoggerFactory.getLogger(DashboardPage.class);
    
    // Locators
    private final By dashboardHeader = By.xpath("//h6[text()='Dashboard']");
    private final By adminMenu = By.xpath("//span[text()='Admin']");
    
    public DashboardPage(WebDriver driver) {
        super(driver);
    }
    
    /**
     * Check if dashboard is displayed
     */
    public boolean isDashboardDisplayed() {
        log.info("Verifying dashboard is displayed");
        waitForPageLoad();
        return isDisplayed(dashboardHeader);
    }
    
    /**
     * Navigate to Admin page
     */
    public AdminPage navigateToAdmin() {
        log.info("Navigating to Admin page");
        click(adminMenu);
        return new AdminPage(driver);
    }
}
EOF

echo "âœ… DashboardPage.java created"

# ==============================================================================
# CREATE ADMINPAGE.JAVA
# ==============================================================================
echo "ðŸ“ Creating AdminPage.java..."
cat > src/main/java/pages/AdminPage.java << 'EOF'
package pages;

import org.openqa.selenium.By;
import org.openqa.selenium.WebDriver;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

/**
 * Page Object for OrangeHRM Admin Page
 */
public class AdminPage extends BasePage {
    
    private static final Logger log = LoggerFactory.getLogger(AdminPage.class);
    
    // Locators
    private final By adminHeader = By.xpath("//h6[text()='Admin']");
    private final By addUserButton = By.xpath("//button[normalize-space()='Add']");
    
    public AdminPage(WebDriver driver) {
        super(driver);
    }
    
    /**
     * Check if Admin page is displayed
     */
    public boolean isAdminPageDisplayed() {
        log.info("Verifying Admin page is displayed");
        waitForPageLoad();
        return isDisplayed(adminHeader);
    }
    
    /**
     * Click Add User button to open user creation form
     */
    public UserManagementPage clickAddUser() {
        log.info("Clicking Add User button");
        click(addUserButton);
        return new UserManagementPage(driver);
    }
}
EOF

echo "âœ… AdminPage.java created"

# ==============================================================================
# CREATE USERMANAGEMENTPAGE.JAVA
# ==============================================================================
echo "ðŸ“ Creating UserManagementPage.java..."
cat > src/main/java/pages/UserManagementPage.java << 'EOF'
package pages;

import models.User;
import org.openqa.selenium.By;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

/**
 * Page Object for User Management functionality
 */
public class UserManagementPage extends BasePage {
    
    private static final Logger log = LoggerFactory.getLogger(UserManagementPage.class);
    
    // Form Locators
    private final By userRoleDropdown = By.xpath("(//div[@class='oxd-select-text-input'])[1]");
    private final By employeeNameInput = By.xpath("//input[@placeholder='Type for hints...']");
    private final By statusDropdown = By.xpath("(//div[@class='oxd-select-text-input'])[2]");
    private final By usernameInput = By.xpath("(//input[@class='oxd-input oxd-input--active'])[2]");
    private final By passwordInput = By.xpath("(//input[@type='password'])[1]");
    private final By confirmPasswordInput = By.xpath("(//input[@type='password'])[2]");
    private final By saveButton = By.xpath("//button[@type='submit']");
    private final By successMessage = By.xpath("//div[@class='oxd-toast oxd-toast--success']");
    
    // Search Locators
    private final By searchUsernameInput = By.xpath("(//input[@class='oxd-input oxd-input--active'])[2]");
    private final By searchButton = By.xpath("//button[@type='submit']");
    private final By recordsFoundText = By.xpath("//span[@class='oxd-text oxd-text--span']");
    
    public UserManagementPage(WebDriver driver) {
        super(driver);
    }
    
    /**
     * Select User Role from dropdown
     */
    public UserManagementPage selectUserRole(String role) {
        log.info("Selecting user role: {}", role);
        click(userRoleDropdown);
        By roleOption = By.xpath("//span[text()='" + role + "']");
        click(roleOption);
        return this;
    }
    
    /**
     * Enter and select Employee Name with autocomplete
     */
    public UserManagementPage selectEmployeeName(String employeeName) {
        log.info("Selecting employee name: {}", employeeName);
        WebElement input = waitForElementVisible(employeeNameInput);
        input.sendKeys(employeeName);
        
        // Wait for autocomplete suggestions
        try {
            Thread.sleep(2000);
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
        }
        
        // Select first suggestion
        By firstSuggestion = By.xpath("//div[@role='listbox']//span");
        click(firstSuggestion);
        return this;
    }
    
    /**
     * Select Status from dropdown
     */
    public UserManagementPage selectStatus(String status) {
        log.info("Selecting status: {}", status);
        click(statusDropdown);
        By statusOption = By.xpath("//span[text()='" + status + "']");
        click(statusOption);
        return this;
    }
    
    /**
     * Enter username
     */
    public UserManagementPage enterUsername(String username) {
        log.info("Entering username: {}", username);
        type(usernameInput, username);
        return this;
    }
    
    /**
     * Enter password
     */
    public UserManagementPage enterPassword(String password) {
        log.info("Entering password");
        type(passwordInput, password);
        return this;
    }
    
    /**
     * Enter confirm password
     */
    public UserManagementPage enterConfirmPassword(String confirmPassword) {
        log.info("Entering confirm password");
        type(confirmPasswordInput, confirmPassword);
        return this;
    }
    
    /**
     * Click Save button
     */
    public UserManagementPage clickSave() {
        log.info("Clicking Save button");
        click(saveButton);
        return this;
    }
    
    /**
     * Create a complete user
     */
    public UserManagementPage createUser(User user) {
        log.info("Creating user: {}", user.getUsername());
        return selectUserRole(user.getUserRole())
               .selectEmployeeName(user.getEmployeeName())
               .selectStatus(user.getStatus())
               .enterUsername(user.getUsername())
               .enterPassword(user.getPassword())
               .enterConfirmPassword(user.getPassword())
               .clickSave();
    }
    
    /**
     * Verify success message is displayed
     */
    public boolean isSuccessMessageDisplayed() {
        log.info("Verifying success message is displayed");
        return isDisplayed(successMessage);
    }
    
    /**
     * Search for user by username
     */
    public UserManagementPage searchUserByUsername(String username) {
        log.info("Searching for user: {}", username);
        type(searchUsernameInput, username);
        click(searchButton);
        waitForPageLoad();
        return this;
    }
    
    /**
     * Get records found count
     */
    public int getRecordsFoundCount() {
        String text = getText(recordsFoundText);
        String number = text.replaceAll("[^0-9]", "");
        int count = Integer.parseInt(number);
        log.info("Records found: {}", count);
        return count;
    }
    
    /**
     * Verify user appears in search results
     */
    public boolean isUserInSearchResults(String username) {
        log.info("Verifying user {} is in search results", username);
        By userInTable = By.xpath("//div[@role='row']//div[text()='" + username + "']");
        return isDisplayed(userInTable);
    }
    
    /**
     * Get user details from search results
     */
    public User getUserFromSearchResults(String username) {
        log.info("Getting user details for: {}", username);
        
        By usernameCell = By.xpath("//div[@role='row']//div[text()='" + username + "']/parent::div");
        WebElement row = waitForElementVisible(usernameCell);
        
        User user = new User();
        user.setUsername(username);
        
        return user;
    }
}
EOF

echo "âœ… UserManagementPage.java created"

# ==============================================================================
# CREATE DRIVERMANAGER.JAVA
# ==============================================================================
echo "ðŸ“ Creating DriverManager.java..."
cat > src/main/java/utils/DriverManager.java << 'EOF'
package utils;

import io.github.bonigarcia.wdm.WebDriverManager;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.chrome.ChromeDriver;
import org.openqa.selenium.chrome.ChromeOptions;
import org.openqa.selenium.edge.EdgeDriver;
import org.openqa.selenium.firefox.FirefoxDriver;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import java.time.Duration;

/**
 * Manages WebDriver instances using ThreadLocal for parallel execution
 */
public class DriverManager {
    
    private static final Logger log = LoggerFactory.getLogger(DriverManager.class);
    private static final ThreadLocal<WebDriver> driver = new ThreadLocal<>();
    
    /**
     * Initialize WebDriver based on configuration
     */
    public static void initializeDriver() {
        String browser = ConfigReader.getBrowser();
        boolean headless = ConfigReader.isHeadless();
        
        log.info("Initializing {} driver (headless: {})", browser, headless);
        
        WebDriver webDriver;
        
        switch (browser.toLowerCase()) {
            case "chrome":
                WebDriverManager.chromedriver().setup();
                ChromeOptions chromeOptions = new ChromeOptions();
                if (headless) {
                    chromeOptions.addArguments("--headless=new");
                }
                chromeOptions.addArguments("--start-maximized");
                chromeOptions.addArguments("--disable-notifications");
                webDriver = new ChromeDriver(chromeOptions);
                break;
                
            case "firefox":
                WebDriverManager.firefoxdriver().setup();
                webDriver = new FirefoxDriver();
                break;
                
            case "edge":
                WebDriverManager.edgedriver().setup();
                webDriver = new EdgeDriver();
                break;
                
            default:
                throw new IllegalArgumentException("Browser not supported: " + browser);
        }
        
        // Set timeouts
        webDriver.manage().timeouts()
            .implicitlyWait(Duration.ofSeconds(ConfigReader.getImplicitWait()));
        webDriver.manage().timeouts()
            .pageLoadTimeout(Duration.ofSeconds(ConfigReader.getPageLoadTimeout()));
        
        // Maximize window
        webDriver.manage().window().maximize();
        
        driver.set(webDriver);
        log.info("Driver initialized successfully");
    }
    
    /**
     * Get the current WebDriver instance
     */
    public static WebDriver getDriver() {
        return driver.get();
    }
    
    /**
     * Quit the WebDriver instance
     */
    public static void quitDriver() {
        if (driver.get() != null) {
            log.info("Quitting driver");
            driver.get().quit();
            driver.remove();
        }
    }
}
EOF

echo "âœ… DriverManager.java created"

# ==============================================================================
# CREATE CONFIGREADER.JAVA
# ==============================================================================
echo "ðŸ“ Creating ConfigReader.java..."
cat > src/main/java/utils/ConfigReader.java << 'EOF'
package utils;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import java.io.IOException;
import java.io.InputStream;
import java.util.Properties;

/**
 * Reads configuration from config.properties file
 */
public class ConfigReader {
    
    private static final Logger log = LoggerFactory.getLogger(ConfigReader.class);
    private static Properties properties;
    
    static {
        loadProperties();
    }
    
    /**
     * Load properties from config.properties file
     */
    private static void loadProperties() {
        properties = new Properties();
        try (InputStream input = ConfigReader.class.getClassLoader()
                .getResourceAsStream("config.properties")) {
            
            if (input == null) {
                log.error("Unable to find config.properties");
                throw new RuntimeException("config.properties not found");
            }
            
            properties.load(input);
            log.info("Configuration loaded successfully");
            
        } catch (IOException e) {
            log.error("Error loading configuration", e);
            throw new RuntimeException("Failed to load configuration", e);
        }
    }
    
    /**
     * Get property value
     */
    private static String getProperty(String key) {
        return properties.getProperty(key);
    }
    
    // Application Configuration
    public static String getBaseUrl() {
        return getProperty("base.url");
    }
    
    public static String getUsername() {
        return getProperty("username");
    }
    
    public static String getPassword() {
        return getProperty("password");
    }
    
    // Browser Configuration
    public static String getBrowser() {
        return getProperty("browser");
    }
    
    public static boolean isHeadless() {
        return Boolean.parseBoolean(getProperty("headless"));
    }
    
    public static int getImplicitWait() {
        return Integer.parseInt(getProperty("implicit.wait"));
    }
    
    public static int getExplicitWait() {
        return Integer.parseInt(getProperty("explicit.wait"));
    }
    
    public static int getPageLoadTimeout() {
        return Integer.parseInt(getProperty("page.load.timeout"));
    }
    
    // Test Data
    public static String getTestUserRole() {
        return getProperty("test.user.role");
    }
    
    public static String getTestUserStatus() {
        return getProperty("test.user.status");
    }
}
EOF

echo "âœ… ConfigReader.java created"

# ==============================================================================
# CREATE USER.JAVA
# ==============================================================================
echo "ðŸ“ Creating User.java..."
cat > src/main/java/models/User.java << 'EOF'
package models;

/**
 * User data model
 */
public class User {
    
    private String employeeName;
    private String username;
    private String userRole;
    private String status;
    private String password;
    
    public User() {
        // Default constructor
    }
    
    public User(String employeeName, String username, String userRole, String status, String password) {
        this.employeeName = employeeName;
        this.username = username;
        this.userRole = userRole;
        this.status = status;
        this.password = password;
    }
    
    // Getters and Setters
    public String getEmployeeName() {
        return employeeName;
    }
    
    public void setEmployeeName(String employeeName) {
        this.employeeName = employeeName;
    }
    
    public String getUsername() {
        return username;
    }
    
    public void setUsername(String username) {
        this.username = username;
    }
    
    public String getUserRole() {
        return userRole;
    }
    
    public void setUserRole(String userRole) {
        this.userRole = userRole;
    }
    
    public String getStatus() {
        return status;
    }
    
    public void setStatus(String status) {
        this.status = status;
    }
    
    public String getPassword() {
        return password;
    }
    
    public void setPassword(String password) {
        this.password = password;
    }
    
    @Override
    public String toString() {
        return "User{" +
                "employeeName='" + employeeName + '\'' +
                ", username='" + username + '\'' +
                ", userRole='" + userRole + '\'' +
                ", status='" + status + '\'' +
                '}';
    }
}
EOF

echo "âœ… User.java created"

# ==============================================================================
# CREATE USERMANAGEMENTSTEPS.JAVA
# ==============================================================================
echo "ðŸ“ Creating UserManagementSteps.java..."
cat > src/test/java/steps/UserManagementSteps.java << 'EOF'
package steps;

import io.cucumber.java.en.Given;
import io.cucumber.java.en.Then;
import io.cucumber.java.en.When;
import models.User;
import org.openqa.selenium.WebDriver;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.testng.Assert;
import pages.AdminPage;
import pages.DashboardPage;
import pages.LoginPage;
import pages.UserManagementPage;
import utils.ConfigReader;
import utils.DriverManager;

import java.util.List;
import java.util.Map;

/**
 * Step definitions for User Management feature
 */
public class UserManagementSteps {
    
    private static final Logger log = LoggerFactory.getLogger(UserManagementSteps.class);
    
    private WebDriver driver;
    private LoginPage loginPage;
    private DashboardPage dashboardPage;
    private AdminPage adminPage;
    private UserManagementPage userManagementPage;
    private User createdUser;
    
    @Given("I am on the OrangeHRM login page")
    public void iAmOnTheLoginPage() {
        driver = DriverManager.getDriver();
        log.info("Navigating to OrangeHRM login page");
        driver.get(ConfigReader.getBaseUrl());
        loginPage = new LoginPage(driver);
        Assert.assertTrue(loginPage.isLoginPageDisplayed(), "Login page should be displayed");
    }
    
    @When("I login with valid credentials")
    public void iLoginWithValidCredentials() {
        log.info("Logging in with valid credentials");
        String username = ConfigReader.getUsername();
        String password = ConfigReader.getPassword();
        dashboardPage = loginPage.login(username, password);
    }
    
    @Then("I should be redirected to the dashboard")
    public void iShouldBeRedirectedToTheDashboard() {
        log.info("Verifying dashboard is displayed");
        Assert.assertTrue(dashboardPage.isDashboardDisplayed(), 
            "Dashboard should be displayed after login");
    }
    
    @Given("I navigate to Admin User Management page")
    public void iNavigateToAdminUserManagementPage() {
        log.info("Navigating to Admin User Management page");
        adminPage = dashboardPage.navigateToAdmin();
        Assert.assertTrue(adminPage.isAdminPageDisplayed(), 
            "Admin page should be displayed");
        userManagementPage = adminPage.clickAddUser();
    }
    
    @When("I create a new user with the following details:")
    public void iCreateANewUserWithFollowingDetails(io.cucumber.datatable.DataTable dataTable) {
        List<Map<String, String>> rows = dataTable.asMaps(String.class, String.class);
        Map<String, String> data = rows.get(0);
        
        // Generate unique username with timestamp
        String timestamp = String.valueOf(System.currentTimeMillis());
        String username = data.get("Username").replace("<timestamp>", timestamp);
        
        // Create user object
        createdUser = new User();
        createdUser.setEmployeeName(data.get("Employee Name"));
        createdUser.setUsername(username);
        createdUser.setUserRole(data.get("User Role"));
        createdUser.setStatus(data.get("Status"));
        createdUser.setPassword("Test@123"); // Default password
        
        log.info("Creating user: {}", createdUser);
        userManagementPage.createUser(createdUser);
    }
    
    @Then("the user should be created successfully")
    public void theUserShouldBeCreatedSuccessfully() {
        log.info("Verifying user creation success");
        Assert.assertTrue(userManagementPage.isSuccessMessageDisplayed(), 
            "Success message should be displayed after user creation");
    }
    
    @When("I search for the user by username {string}")
    public void iSearchForUserByUsername(String usernameTemplate) {
        // Replace placeholder with actual username
        String username = createdUser.getUsername();
        log.info("Searching for user: {}", username);
        userManagementPage.searchUserByUsername(username);
    }
    
    @Then("the user should appear in the Records Found table")
    public void theUserShouldAppearInRecordsFoundTable() {
        log.info("Verifying user appears in search results");
        int recordsFound = userManagementPage.getRecordsFoundCount();
        Assert.assertTrue(recordsFound > 0, 
            "At least one record should be found");
        
        boolean userExists = userManagementPage.isUserInSearchResults(createdUser.getUsername());
        Assert.assertTrue(userExists, 
            "User should appear in search results table");
    }
    
    @Then("the user details should be correct")
    public void theUserDetailsShouldBeCorrect() {
        log.info("Verifying user details are correct");
        User foundUser = userManagementPage.getUserFromSearchResults(createdUser.getUsername());
        Assert.assertEquals(foundUser.getUsername(), createdUser.getUsername(), 
            "Username should match");
    }
}
EOF

echo "âœ… UserManagementSteps.java created"

# ==============================================================================
# CREATE HOOKS.JAVA
# ==============================================================================
echo "ðŸ“ Creating Hooks.java..."
cat > src/test/java/steps/Hooks.java << 'EOF'
package steps;

import io.cucumber.java.After;
import io.cucumber.java.Before;
import io.cucumber.java.Scenario;
import org.openqa.selenium.OutputType;
import org.openqa.selenium.TakesScreenshot;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import utils.DriverManager;

/**
 * Cucumber hooks for test setup and teardown
 */
public class Hooks {
    
    private static final Logger log = LoggerFactory.getLogger(Hooks.class);
    
    @Before
    public void setUp(Scenario scenario) {
        log.info("Starting scenario: {}", scenario.getName());
        DriverManager.initializeDriver();
    }
    
    @After
    public void tearDown(Scenario scenario) {
        log.info("Finishing scenario: {}", scenario.getName());
        
        // Take screenshot if scenario failed
        if (scenario.isFailed()) {
            log.error("Scenario failed, taking screenshot");
            takeScreenshot(scenario);
        }
        
        DriverManager.quitDriver();
    }
    
    /**
     * Take screenshot and attach to report
     */
    private void takeScreenshot(Scenario scenario) {
        try {
            byte[] screenshot = ((TakesScreenshot) DriverManager.getDriver())
                .getScreenshotAs(OutputType.BYTES);
            scenario.attach(screenshot, "image/png", scenario.getName());
            log.info("Screenshot captured successfully");
        } catch (Exception e) {
            log.error("Failed to capture screenshot", e);
        }
    }
}
EOF

echo "âœ… Hooks.java created"

# ==============================================================================
# CREATE TESTRUNNER.JAVA
# ==============================================================================
echo "ðŸ“ Creating TestRunner.java..."
cat > src/test/java/runners/TestRunner.java << 'EOF'
package runners;

import io.cucumber.testng.AbstractTestNGCucumberTests;
import io.cucumber.testng.CucumberOptions;
import org.testng.annotations.DataProvider;

/**
 * TestNG runner for Cucumber tests
 */
@CucumberOptions(
    features = "src/test/resources/features",
    glue = {"steps"},
    plugin = {
        "pretty",
        "html:target/cucumber-reports/cucumber.html",
        "json:target/cucumber-reports/cucumber.json",
        "junit:target/cucumber-reports/cucumber.xml"
    },
    monochrome = true,
    dryRun = false
)
public class TestRunner extends AbstractTestNGCucumberTests {
    
    /**
     * Enable parallel execution
     */
    @Override
    @DataProvider(parallel = false)
    public Object[][] scenarios() {
        return super.scenarios();
    }
}
EOF

echo "âœ… TestRunner.java created"

# ==============================================================================
# CREATE README.MD
# ==============================================================================
echo "ðŸ“ Creating README.md..."
cat > README.md << 'EOF'
# OrangeHRM UI Automation Testing

Automated UI testing project for OrangeHRM using Selenium WebDriver, Cucumber BDD, and Page Object Model pattern.

## ðŸ› ï¸ Technology Stack

- **Java 11**
- **Selenium WebDriver 4.16.1**
- **Cucumber 7.14.1** (BDD Framework)
- **TestNG 7.8.0** (Test Execution)
- **WebDriverManager 5.6.2** (Browser Driver Management)
- **Maven** (Build Tool)

## ðŸ“‹ Prerequisites

- Java JDK 11 or higher
- Maven 3.6+
- Chrome/Firefox/Edge browser installed

## ðŸš€ Quick Start

### 1. Build the project

```bash
mvn clean install
```

### 2. Run tests

```bash
mvn test
```

### 3. View test report

```bash
open target/cucumber-reports/cucumber.html
```

## ðŸ“Š Test Reports

After test execution, reports are generated in:

- **HTML Report**: `target/cucumber-reports/cucumber.html`
- **JSON Report**: `target/cucumber-reports/cucumber.json`
- **XML Report**: `target/cucumber-reports/cucumber.xml`

## ðŸŽ¯ Test Scenarios

### User Management

**Scenario**: Create and verify a new user
1. Login to OrangeHRM with valid credentials
2. Navigate to Admin â†’ User Management
3. Create a new user with valid data
4. Verify user creation success message
5. Search for the newly created user
6. Verify user appears in search results

## ðŸ“ Project Structure

```
orangehrm-automation/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main/java/
â”‚   â”‚   â”œâ”€â”€ pages/              # Page Object Model classes
â”‚   â”‚   â”œâ”€â”€ utils/              # Utility classes
â”‚   â”‚   â””â”€â”€ models/             # Data models
â”‚   â””â”€â”€ test/
â”‚       â”œâ”€â”€ java/
â”‚       â”‚   â”œâ”€â”€ runners/        # Test runners
â”‚       â”‚   â””â”€â”€ steps/          # Step definitions
â”‚       â””â”€â”€ resources/
â”‚           â”œâ”€â”€ features/       # Cucumber feature files
â”‚           â””â”€â”€ config.properties
â”œâ”€â”€ pom.xml
â””â”€â”€ README.md
```

## âš™ï¸ Configuration

Edit `src/test/resources/config.properties`:

```properties
base.url=https://opensource-demo.orangehrmlive.com/web/index.php/auth/login
username=Admin
password=admin123
browser=chrome
headless=false
```

## ðŸ§ª Running Tests

### Run all tests
```bash
mvn test
```

### Run with specific browser
```bash
mvn test -Dbrowser=firefox
```

### Run in headless mode
```bash
mvn test -Dheadless=true
```

## ðŸ‘¤ Author

Created for ABBANK Quality Engineer Assessment

---

**Note**: This framework demonstrates professional automation testing practices suitable for mid to senior-level QE positions.
EOF

echo "âœ… README.md created"

# ==============================================================================
# COMPLETION MESSAGE
# ==============================================================================
echo ""
echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘              âœ… PROJECT SETUP COMPLETED!                      â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "ðŸ“ Project structure:"
echo ""
find . -type f -name "*.java" -o -name "*.xml" -o -name "*.properties" -o -name "*.feature" -o -name "*.md" | head -20
echo ""
echo "ðŸŽ¯ Next steps:"
echo ""
echo "  1. Install dependencies:"
echo "     mvn clean install"
echo ""
echo "  2. Run tests:"
echo "     mvn test"
echo ""
echo "  3. View report:"
echo "     open target/cucumber-reports/cucumber.html"
echo ""
echo "ðŸ“š Documentation:"
echo "  - README.md         : Project overview"
echo "  - config.properties : Test configuration"
echo ""
echo "ðŸŽ‰ Happy Testing!"
echo ""
